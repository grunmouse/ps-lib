%% Русский чертёжный шрифт ЕСКД Б наклонный


(font-matrix-eskd.ps) run
(rus-encoding.ps) run

<<
	%Required for all fonts
	/FontType 3
	/FontMatrix eskd-b-oblique
	
	%Required for base fonts
	
	/Encoding rus-translit-encoding %Кодовая страница.
	
	/FontBBox [0 0 0 0] %Потом заменить реальными значениями
	
	%Запускается для отрисовки символа
	%[this, charName]
	/BuildGlyph {
		
		%[this, charName]
		1 index 
		%[this, charName, this]
		begin
			%[this, charName]
			CharProcs
			%[this, charName, this.CharProcs]
			exch % Get CharProcs dictionary
			
			%[this, this.CharProcs, charName]
			2 copy known not % See if charname is known
			{pop /.notdef}
			if
		
			%[this, this.CharProcs, charName]
			dup /.notdef eq
			{
				pop pop pop
				%/.notdef ==
			}
			{
				%[this, this.CharProcs, charName]
				get
				%[this, this.CharProcs.charName]
				
				%[this, this.CharProcs.charName]
				beforeGliph
				exec % Execute BuildGlyph procedure with [this]
				afterGliph
				
				%[this]
				pop
			}
			ifelse
		end
		
	}
	
	/beforeGliph{
	}
	/afterGliph{
		stroke
		pop
	}
	
	%Устаревшая схема, для совместимости
	%[this, charCode]
	/BuildChar {
		1 index /Encoding get
		%[this, charCode, this.Encoding]
		exch get
		%[this, charName]
		1 index /BuildGlyph get 
		%[this, charName, this.BuildGlyph]
		exec
	} bind
	
	%========== Специфичные члены для ЕСКД Б
	/h 10 %высота прописных букв
	/c 7  %высота строчных букв
	/a 2  %расстояние между буквами
	/b 17 %интерлиньяж
	/e 6  %расстояние между словами
	/d 1  % толщина линии
	
	%[g]
	/setconfig {
		/g exch def %определяем g
		/right g 1 sub def %легаси
		/center right 2 div def
		
		g a add  
		0
		% Width
			
		-2 -3  
		3 index  
		h 2 add
		% Bounding box
		setcachedevice

		d setlinewidth
		
		0.5 0.5 translate
		
		2 setlinecap			
		
	}
	%[]
	
	%[g]
	/dobegin {
		0 dict dup 
		%[g, -dict-config-, -dict-config-]
		3 1 roll 
		%[-dict-config-, g, -dict-config-]
		begin
			%[-dict-, g]
			setconfig
	}
	%[-dict-config-]
	
	/uppertop {
		/top h 1 sub def
	}
	
	/lowertop {
		/top c 1 sub def
	}
	
	/middlefloor {
		/middle top 2 div floor def
	}
	
	/middleceil {
		/middle top 2 div ceiling def
	}
	
	%[g]
	/lowerbegin {
		dobegin
			lowertop
			middleceil
	}	
	%[-dict-config-]
	
	%[g]
	/upperfloorbegin {
		dobegin
			uppertop
			middleceil
	}
	%[-dict-config-]

	%[g]
	/upperceilbegin {
		dobegin
			uppertop
			middlefloor
	}
	%[-dict-config-]
	
	%[-dict-config-]
	/overbegin {
		dup
		begin
			0 top 1 add translate
			/top 1 def
	}
	%[-dict-config-]
	
	/subglyph <<
		/uml {
			1 setlinejoin 
			0 setlinecap
			0.5 top moveto
			1 0 rlineto
			1 0 rmoveto
			1 0 rlineto
		}
		/breve {
			0 setlinecap
			1 top moveto
			right 1 sub top lineto
		}
	>>

	
	/CharProcs <<
		/.notdef {}
		/space {
			e
			dobegin
			end
		}
		
		/nil {
			5 upperceilbegin
				0 0 moveto
				2 right top glifo
			end
		}
		/un {
			3 upperfloorbegin
				1 setlinejoin
				0 top 2 sub moveto
				right top lineto
				right 0 lineto
			end
		}
		/bi {
			5 upperceilbegin
				right 0 moveto
				0 0 lineto
				right top 2 sub lineto
				2 -1 1 arcty
				0 2 xlinearcdown
			end
		}	
		/tri {
			5 upperfloorbegin
				0 0 moveto
				right 2 xlinearcup
				middle 2 ylinearcleft
				1 middle moveto
				right 1.5 xlinearcup
				top 1.5 ylinearcleft
				0 top lineto
		}
		/quad {
			5 upperceilbegin
				right top moveto
				0 2 lineto
				right 1 add 2 lineto
				right 0 moveto
				right middle lineto
			end
		}
		/pent {
			5 upperfloorbegin
				0 0 moveto
				right 2 xlinearcup
				middle 2 ylinearcleft
				0 middle lineto
				0 top lineto
				right top lineto
			end
		}
		/hex {
			5 upperfloorbegin
				right 1 sub top moveto
				0 3 xlinearcdown
				0 1 ylinearcright
				right 1 xlinearcup
				middle 1 ylinearcleft
				0 middle lineto
			end
		}
		/sept {
			5 upperceilbegin
				1 0 moveto
				right top lineto
				0 top lineto
				0 -1 rlineto
			end
		}
		/oct {
			5 upperfloorbegin
				center middle moveto
				right 2 xlinearcup
				top 2 ylinearcleft
				0 2 xlinearcdown
				middle 2 ylinearcright
				right 2 xlinearcdown
				0 1.5 ylinearcleft
				0 1.5 xlinearcup
				middle 2 ylinearcright
			end
		}	
		/en {
			5 upperceilbegin
				1 0 moveto
				right 3 xlinearcup
				top 1 ylinearcleft
				0 1 xlinearcdown
				middle 1 ylinearcright
				right middle lineto
			end
		}
		
		/A {
			7 upperceilbegin
				1 setlinejoin
				0 0 moveto
				center top lineto
				right 0 lineto
				center top div 2 mul dup 2 moveto
				right exch sub 2 lineto
				
			end
		}
		/B {
			6 upperfloorbegin
				0 top moveto
				0 0 lineto
				1 right middle glifrc
				0 top moveto
				right 1 sub 0 rlineto
				
			end
		}
		/W {
			6 upperfloorbegin
				0 top moveto
				0 0 lineto
				1 right middle glifrc
				0 top moveto
				right 1 sub 1 xlinearcdown
				middle 2 ylinearcleft
				
			end
		}
		/G {
			4 upperfloorbegin
				0 0 moveto
				0 top lineto
				right 1 add top lineto
				
			end
		}
		/D {
			5 upperfloorbegin
				-1 -1 moveto
				-1 0 lineto
				right 1 add 0 lineto
				0 -1 rlineto
				0 0 moveto
				1 setlinejoin 
				1  top lineto
				right top  lineto
				0 setlinejoin 
				right 0 lineto
				
			end
		}
		/JE {
			5 upperfloorbegin
				right 0 moveto
				0 0 lineto
				0 top lineto
				right top lineto
				0 middle moveto
				3 0 rlineto
				
			end
		}
		/JO {
			CharProcs /JE get exec
			stroke
			overbegin
				subglyph /uml get exec
			end		
		}
		/V {
			8 upperfloorbegin
				
				center 0 moveto
				center top lineto
				
				center middle moveto
				right top lineto
				center middle moveto
				0 top lineto
				
				center middle moveto 
				top middle sub center div dup
				1 exch rmoveto
				right 0 lineto
				
				center middle moveto
				-1 exch rmoveto
				0 0 lineto
				
			end
		}
		/Z {
			5 upperfloorbegin
				1 setlinecap
				0 1 moveto
				1 1 -1 arcty
				right 2 xlinearcup
				middle 2 ylinearcleft
				-1 0 rlineto
				1 0 rmoveto
				2 1 1 arctx
				top 1 ylinearcleft
				0 1 xlinearcdown
				
			end
		}
		/I {
			6 upperfloorbegin
				1 setlinejoin 
				0 top moveto
				0 0 lineto
				right top lineto
				right 0 lineto
				
			end
		}
		/J {
			2 setlinecap
			CharProcs /I get exec
			stroke
			overbegin
				subglyph /breve get exec
			end
		}
		/K {
			5 upperfloorbegin
				0 0 moveto
				0 top lineto
				0 middle moveto
				right top lineto
				0 middle moveto 1 top middle sub middle div 1 rmoveto
				right 0 lineto
				
			end
		}
		/L {
			6 upperfloorbegin
				0 0 moveto
				2 top lineto
				right top lineto
				right 0 lineto
				
			end
		}
		/M {
			7 upperfloorbegin
				1 setlinejoin 
				0 0 moveto
				0 top lineto
				center middle lineto
				right top lineto
				right 0 lineto
				
			end
		}
		/N {
			6 upperfloorbegin
				0 0 moveto
				0 top rlineto
				
				right 0 moveto
				0 top rlineto
				
				0 middle moveto
				right 0 rlineto
				
			end
		}
		/O {
			6 upperfloorbegin
				0 0 moveto
				2 right top glifo
				
			end
		}
		/P {
			6 upperfloorbegin
				0 0 moveto
				0 top lineto
				right top lineto
				right 0 lineto
				
			end
		}
		/R {
			6 upperceilbegin
				0 0 moveto
				0 top lineto
				0 middle moveto
				1 right top glifrc
				
			end
		}
		/S {
			6 upperceilbegin
				right top moveto
				1 0 0 glifc
				
			end
		}
		/T {
			6 upperceilbegin
				center 0 moveto
				0 top rlineto
				0 top moveto
				right 0 rlineto
				
			end
		}
		/U {
			6 upperceilbegin
				0 top moveto
				middle 1 ylinearcright
				right middle lineto
				right top moveto
				0 2 ylinearcleft
				1 0 lineto
				
			end
		}
		/F {
			8 upperceilbegin
				center 0 moveto
				0 top rlineto
				0 2 moveto

					2 
					right 
					top 2 sub 
				glifo
				
			end
		}
		/H {
			7 upperceilbegin
				0 0 moveto
				right top lineto
				0 top moveto
				right 0 lineto
				
			end
		}
		/C {
			6 upperceilbegin
				0 top  moveto
				0 0 lineto
				g 0 lineto
				0 -1 rlineto
				right top moveto
				right 0 lineto
				
			end
		}
		/CH {
			6 upperceilbegin
				0 top moveto
				middle 1 ylinearcright
				right middle lineto
				right top moveto
				right 0 lineto
				
			end
		}
		/SH {
			8 upperceilbegin
				0 top moveto
				0 0 lineto
				right 0 lineto
				right top lineto
				center 0 moveto
				0 top rlineto
				
			end
		}
		/SHX {
			8 upperceilbegin
				0 top moveto
				0 0 lineto
				right 0 lineto
				right top lineto
				center 0 moveto
				0 top rlineto
				right 1 add 0 moveto
				0 -1 rlineto
				
			end
		}
		/ER {
			6 upperfloorbegin
				0 0 moveto
				1 right middle glifrc
				0 0 moveto
				0 top lineto
				-2 0 rlineto
				
			end
		}
		/Y {
			7 upperfloorbegin
				0 0 moveto
				1 4 middle glifrc
				0 0 moveto
				0 top lineto
				right top moveto
				right 0 lineto
				
			end		
		}
		/X {
			6 upperfloorbegin
				0 0 moveto
				1 right middle glifrc
				0 0 moveto
				0 top lineto
			end
		}
		/E {
			6 upperfloorbegin
				0 0 moveto
				1 right top glifrc
				right middle moveto
				center middle lineto
				
			end
		}
		/JU {
			7 upperfloorbegin
				0 0 moveto 0 top lineto
				0 middle moveto	2 0 rlineto
				2 0 moveto
				2 right top glifo
				
			end
		}
		/JA {
			6 upperceilbegin
				1 setlinecap
				right 0 moveto
				right top lineto
				
				1 0 middle glifc
				center middle moveto
				
				0 0 lineto
				
			end
		}
		/a {
			5 lowerbegin
				right top moveto
				0 1 xlinearcdown
				0 1 ylinearcright
				right 1 xlinearcup
				right top lineto
				right 1 moveto
				1 -1 rlineto
				
			end
		}
		/b {
			5 lowerbegin
				1 setlinejoin
				right 1 sub dup top moveto
				neg 3 rlineto
				right 0 rlineto
				0 0 moveto
				1 right top glifo
				
			end
		}
		/w {
			5 lowerbegin
				0 top moveto
				right 1 xlinearcdown
				0 1 ylinearcleft
				0 1 xlinearcup
				top 3 add 1 ylinearcright
				2 1 xlinearcdown
				1 top lineto
				
			end
		}
		/g {
			4 lowerbegin
				1 setlinejoin
				1 setlinecap
				0 top moveto 0 -1 rmoveto
				1 1 1 arcty
				right 1 xlinearcdown
				0 2 lineto
				0 1 ylinearcright
				right 0.5 add 1 xlinearcup
				
			end
		}
		/d {
			5 lowerbegin
				0 top moveto 1 3 rmoveto
				right 1 xlinearcdown
				0 1 ylinearcleft
				0 1 xlinearcup
				top 1 ylinearcright
				right 1 xlinearcdown
				
			end
		}
		/je {
			5 lowerbegin
				right 0 moveto
				0 1 xlinearcup
				top 1 ylinearcright
				right 1 xlinearcdown
				middle 1 ylinearcleft
				0 middle lineto
				
			end
		}
		/jo {
			CharProcs /je get exec
			stroke
			overbegin
				subglyph /uml get exec
			end		
		}
		/v {
			7 lowerbegin
				center  0  moveto
				center  top lineto
				
				center  middle moveto
				right top lineto

				center  middle moveto
				0  top lineto

				center  middle moveto 0.5 0.5 rmoveto
				right 0  lineto
				center  middle moveto -0.5 0.5 rmoveto
				0  0  lineto
				
			end
		}
		/z {
			4 lowerbegin
				1 setlinecap
				0 1 moveto
				1 1 -1 arcty
				right 1 xlinearcup
				middle 1 ylinearcleft
				-1 0 rlineto
				1 0 rmoveto
				1 1 1 arctx
				top 1 ylinearcleft
				0 1 xlinearcdown
				
			end
		}
		/i {
			5 lowerbegin
				0 top moveto
				0 1 ylinearcright
				right 0 lineto
				right top lineto
				
			end
		}
		/j {
			CharProcs /i get exec
			stroke
			overbegin
				subglyph /breve get exec
			end		
		}
		/k {
			5 lowerbegin
				0 0 moveto
				0 top lineto
				0 middle 1 sub moveto
				right top lineto
				0 middle moveto 2 middle right div 2 mul 1 sub rmoveto
				right 0 lineto
				
			end
		}
		/l {
			5 lowerbegin
				1 setlinejoin
				0 0 moveto
				2 top lineto
				0 setlinejoin
				right top lineto
				right 0 lineto
				
			end
		}
		/m {
			5 lowerbegin
				1 setlinejoin
				0 0 moveto
				0 top lineto
				center middle lineto
				right top lineto
				right 0 lineto
				
			end
		}
		/n {
			5 lowerbegin
				0 0 moveto
				0 top lineto
				0 middle moveto
				right middle lineto
				right 0 moveto
				right top lineto
				
			end
		}
		/o {
			5 lowerbegin
				0 0 moveto
				1 right top glifo
				
			end
		}
		/p {
			5 lowerbegin
				0 0 moveto
				0 top lineto
				right 1 xlinearcdown
				right 0 lineto
				
			end
		}
		/r {
			5 lowerbegin
				0 top moveto
				0 -3 lineto
				0 0 moveto
				1 right top glifrc
				
			end
		}
		/s {
			4 lowerbegin
				right top moveto
				1 0 0 glifc
				
			end
		}
		/t {
			7 lowerbegin
				0 0 moveto
				0 top lineto
				right 1 xlinearcdown
				right 0 lineto
				center top moveto
				center 0 lineto
				
			end
		}
		/u {
			5 lowerbegin
				0 top moveto
				0 1 ylinearcright
				right 0 lineto
				right top moveto
				-3 2 ylinearcleft
				1 -3 lineto
				
			end
		}
		/f {
			7 lowerbegin
				0 0 moveto
				1 right top glifo
				center top moveto 0 2 rmoveto 
				center -3 lineto
				
			end
		}
		/h {
			5 lowerbegin
				0 0 moveto
				right top lineto
				right 0 moveto
				0 top lineto
				
			end
		}
		/c {
			4 lowerbegin
				0 top moveto
				0 0 lineto
				right 1 add 0 lineto
				0 -1 rlineto
				right top moveto
				right 0 lineto
				
			end
		}
		/ch {
			5 lowerbegin
				0 top moveto
				middle 1 ylinearcright
				right middle lineto
				right top moveto
				right 0 lineto
				
			end
		}
		/sh {
			7 lowerbegin
				0 top moveto
				0 1 ylinearcright
				right 0 lineto
				right top lineto
				center 0 moveto
				center top lineto
				
			end
		}
		/shx {
			7 lowerbegin
				0 top moveto
				0 1 ylinearcright
				right 0 lineto
				right top lineto
				center 0 moveto
				center top lineto
				right 1 add 0 moveto
				0 -1 rlineto
				
			end
		}
		/er {
			5 lowerbegin
				0 0 moveto
				1 right middle glifrc
				0 0 moveto
				0 top lineto
				-1 0 rlineto
				
			end
		}
		/y {
			6 lowerbegin
				0 0 moveto
				1 3 middle glifrc
				0 0 moveto
				0 top lineto
				right 0 moveto
				right top lineto
				
			end
		}
		/x {
			5 lowerbegin
				0 0 moveto
				1 right middle glifrc
				0 0 moveto
				0 top lineto
				
			end
		}
		/e {
			5 lowerbegin
				0 0 moveto
				1 right top glifrc
				right middle moveto
				-2 0 rlineto
				
			end
		}
		/ju {
			6 lowerbegin
				0 0 moveto 0 top lineto
				0 middle moveto 2 0 rlineto
				2 0 moveto
				1 right top glifo
				
			end
		}
		/ja {
			5 lowerbegin

				right 0 moveto
				right top lineto
				
				1 0 middle glifc
				center middle moveto
				
				0 0 lineto
				
			end
		}
	>>
	
>>  dup begin
	(font-tools.ps) run
end

/rus-eskd-font exch definefont pop